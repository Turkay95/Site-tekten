<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Modifier un composant</h1>
  <div>
    <a href="/admin/components" class="btn btn-sm btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Retour à la liste
    </a>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <form action="/admin/components/<%= component.id %>?_method=PUT" method="POST" enctype="multipart/form-data">
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="name" class="form-label">Nom <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="name" name="name" value="<%= component.name %>" required>
          </div>

          <div class="mb-3">
            <label for="type" class="form-label">Type de composant <span class="text-danger">*</span></label>
            <select class="form-select" id="type" name="type" required>
              <option value="CPU / Processeur" <%= (component.type || '').includes('CPU') || (component.type || '').toLowerCase().includes('proc') ? 'selected' : '' %>>CPU / Processeur</option>
              <option value="Carte mere" <%= (component.type || '').toLowerCase().includes('carte') || (component.type || '').toLowerCase().includes('mere') ? 'selected' : '' %>>Carte mère</option>
              <option value="RAM" <%= (component.type || '').toLowerCase().includes('ram') ? 'selected' : '' %>>Mémoire RAM</option>
              <option value="Carte graphique GPU" <%= (component.type || '').toLowerCase().includes('gpu') || (component.type || '').toLowerCase().includes('graph') ? 'selected' : '' %>>Carte graphique (GPU)</option>
              <option value="SSD / Stockage" <%= (component.type || '').toLowerCase().includes('ssd') || (component.type || '').toLowerCase().includes('stock') ? 'selected' : '' %>>SSD / Stockage</option>
              <option value="Boitier PC" <%= (component.type || '').toLowerCase().includes('boitier') || (component.type || '').toLowerCase().includes('botier') ? 'selected' : '' %>>Boîtier PC</option>
              <option value="Alimentation PSU" <%= (component.type || '').toLowerCase().includes('psu') || (component.type || '').toLowerCase().includes('alim') ? 'selected' : '' %>>Alimentation (PSU)</option>
              <option value="Refroidissement / Cooling" <%= (component.type || '').toLowerCase().includes('cool') || (component.type || '').toLowerCase().includes('refroid') ? 'selected' : '' %>>Refroidissement</option>
            </select>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="price" class="form-label">Prix (€) <span class="text-danger">*</span></label>
                <div class="input-group">
                  <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" value="<%= component.price %>" required>
                  <span class="input-group-text">€</span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="stock" class="form-label">Stock <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="stock" name="stock" min="0" value="<%= component.stock %>" required>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="brand" class="form-label">Marque</label>
                <input type="text" class="form-control" id="brand" name="brand" value="<%= component.brand || '' %>">
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="weight" class="form-label">Poids (kg)</label>
                <input type="number" class="form-control" id="weight" name="weight" step="0.01" min="0" value="<%= component.weight || '' %>">
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="material" class="form-label">Format / Matériau</label>
            <input type="text" class="form-control" id="material" name="material" value="<%= component.material || '' %>" placeholder="ATX, Micro-ATX, ITX, aluminium, plastique, ...">
          </div>

          <div class="mb-3">
            <label for="compatibleWith" class="form-label">Compatible avec</label>
            <input type="text" class="form-control" id="compatibleWith" name="compatibleWith" value="<%= component.compatibleWith || '' %>" placeholder="Socket AM5, LGA1700, DDR5, carte mère ASUS B650, ...">
          </div>
        </div>

        <div class="col-md-6">
          <div class="mb-3">
            <label for="image" class="form-label">Image</label>
            <div class="border rounded p-3 text-center bg-light" style="min-height: 200px; display: flex; align-items: center; justify-content: center;">
              <% if (component.image) { %>
                <img id="imagePreview" src="<%= component.image %>" alt="<%= component.name %>" style="max-width: 100%; max-height: 200px; object-fit: contain;">
              <% } else { %>
                <div id="noImagePreview" class="text-center">
                  <i class="bi bi-image fs-1 text-muted mb-2 d-block"></i>
                  <p class="text-muted mb-0">Aucune image</p>
                </div>
              <% } %>
            </div>
            <input type="file" class="form-control mt-2" id="image" name="image" accept="image/*" onchange="previewImage(this)">
            <div class="form-text">Laissez vide pour conserver l'image actuelle. Formats acceptés : JPG, PNG, GIF (max 5Mo)</div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
        <textarea class="form-control" id="description" name="description" rows="5" required><%= component.description %></textarea>
      </div>

      <div class="d-flex justify-content-between">
        <a href="/admin/components" class="btn btn-outline-secondary">Annuler</a>
        <button type="submit" class="btn btn-success">
          <i class="bi bi-save"></i> Enregistrer
        </button>
      </div>
    </form>
  </div>
</div>

<script>
function previewImage(input) {
  const file = input.files[0];
  const reader = new FileReader();
  const preview = document.getElementById('imagePreview');
  const empty = document.getElementById('noImagePreview');
  reader.onload = function(e) {
    if (preview) {
      preview.src = e.target.result;
    } else {
      input.previousElementSibling.innerHTML = `<img id="imagePreview" src="${e.target.result}" alt="Aperçu" style="max-width: 100%; max-height: 200px; object-fit: contain;">`;
    }
  }
  if (file) reader.readAsDataURL(file);
}
</script>
